---
title: "Lab 7 Correlation (part 1)"
author: "B. Sosnovski"
date: "03/28/2022"
output: 
  html_document: 
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Correlation (Part 1)


The idea of correlation was discussed in the lecture and the textbook. This is the idea that two things that we measure can be somehow related to one another. 

Some of the relationships we can measure are meaningful and might reflect a causal relationship where one thing causes a change in another. Some of the relationships are spurious and do not reflect a causal relationship.

In this lab, you will learn how to compute correlations between two variables in software and then ask questions about the correlations you observe.

## General Goals

The goals for this lab are the following:

1. To compute Pearson's r (correlation coefficient) between two variables using software
2. To discuss the possible meaning of correlations that you observe

## Important Info

We use data from the [World Happiness Report](http://worldhappiness.report). They just released the 10th Anniversary Edition of their report for data for 2022. 

The 2018 and 2022 data sets from Happiness Report are already available to you in this lab's folder as this lab.



## cor for correlation

R has the `cor` function for computing correlation coefficient *r* (Pearson's coefficient) between any two variables. This same function computes other correlation versions, but we'll skip those here. To use the function, you need two variables with numbers in them like these:

```{r}
x  <- c(5,3,2,5,4,6,4,8,7)
y  <- c(6,5,6,7,8,9,8,10,12)
cor(x,y)
```

### Example

Create two lists of 5 numbers and ask R to calculate the correlation. Use variables *w* and *z* to represent your lists.

`Enter your code below:`



## Generating a uniform distribution

You can use the `runif()` function to sample random numbers from a uniform distribution between a minimum and a maximum value. 

In the example below, sample 15 (n=15) random numbers between the range 8 (min = 8) and 30 (max=30). Every time you run this code, the 15 values in x will be re-sampled, and 15 new random numbers.

```{r}
x <- runif(n=15, min=8, max=30)
x
```

You can compute the correlation between two sets of random numbers by first sampling random numbers into each variable and then running the `cor()` function.

```{r}
x <- runif(n=15, min=8, max=30)
y <- runif(n=15, min=8, max=30)
cor(x,y)
```

Running the above code will give different values for the correlation each time because the numbers in x and y are always randomly different. 

As you learned from the textbook, we can find correlations by chance alone, even when there is no actual correlation between the variables. For example, if we sampled randomly into x and then sampled some numbers randomly into y. We know they aren't related because we randomly sampled the numbers. However, doing this creates some correlations by chance. 


## Chance correlations

Let's explore the idea that correlations between two measures can arise by chance alone by generating a sample of 50 correlations and then estimate the mean of these correlations generated by chance. We should expect that the mean of these correlations should be zero because they rise from randomly selected x and y distributions.

One way to estimate the mean of the correlations is to repeat the above code many times. For example, if you run the above code 50 times, you could save the correlations each time, then compute the mean. This would estimate the mean of correlations that can be produced by chance. How can you repeat the above code many times to solve this problem? 

We can do this using a `for` loop. The code below shows how to repeat everything inside the for loop 50 times. The variable `i` is an index that goes from 1 to 50. The `saved_value` variable starts as an empty variable, and then we put a value into it (at index position i, from 1 to 50). In this code, we put the correlations of x and y into the `saved_value` variable. At the end of the simulation, the `save_value` variable contains 50 numbers. The `mean()` function is used to find the mean value for the 50 simulations. 

Doing this will allow you to run the simulation 50 times and find the mean correlation that arises by chance. 

```{r}
saved_value <- c() #make an empty variable
for (i in 1:50){
  x <- runif(n=15, min=8, max=30)
  y <- runif(n=15, min=8, max=30)
  saved_value[i] <- cor(x,y)
}
saved_value
mean(saved_value)
```

You can see that the mean is not always zero. Sometimes it looks like there is a correlation when we know there shouldn't be. You can keep re-doing these simulations by re-building (re-knitting) your R Markdown document. You simulate the outcomes as often as you press the "Build" button.

### Example

Create two lists of 100 numbers and use R to calculate the standard deviation of the correlations.

`Enter your code below:`




## World Happiness Report

Let's take a look at some correlations in real data. We are going to look at responses to a questionnaire about happiness that was sent around the world from the [world happiness report](http://worldhappiness.report)

### Load the data

We load the data into a data frame. Reminder, the following assumes that you have downloaded the data.

```{r, warning=F, message=F}
library(data.table)
whr18_data <- fread('WHR2018.csv')
```

If the Internet is enabled in your project, you can also load the data using the following URL

```{r, warning=F, message=F, eval=F}
library(data.table)
whr_data <- fread("https://raw.githubusercontent.com/CrumpLab/statisticsLab/master/data/WHR2018.csv")
```

### Look at the data

```{r, warning=F, message=F}
dim(whr18_data)
colnames(whr18_data)
head(whr18_data)
```

You should see that there is data for many different countries across a few different years. There are many different kinds of measures, each given a name. I'll show you some examples of asking about correlations with this data; then, you get to ask and answer your questions.

### Question
 
For the year 2017 only, does a country's measure for "freedom to make life choices" correlate with the country's measure for "Confidence in national government"?

Let's find out. We calculate the correlation:


```{r}
x <- whr18_data$`Freedom to make life choices`
y <- whr18_data$`Confidence in national government`
cor(x,y)
head(x,100)
```

What happened here? The correlation was `NA` (meaning undefined) because there are some missing data points. We can remove all the rows with missing data first, then do the correlation. 



### Removing NA values

We will do this in a couple of steps. First, create our own data frame with only the numbers we want to analyze. We can select the columns we want to keep using `select`. Then we use `filter` to remove the rows with NAs.


```{r, warning=F, message=F}
library(dplyr)
smaller_df <- whr18_data %>%
               select(country, year,
                      `Freedom to make life choices`,
                      `Confidence in national government`) %>%
               filter(!is.na(`Freedom to make life choices`),
                      !is.na(`Confidence in national government`))

smaller_df <- smaller_df %>% filter(year=='2017')
sx <- smaller_df$`Freedom to make life choices`
sy <- smaller_df$`Confidence in national government`
r <- cor(sx,sy)
r
```

Now we see the correlation is `r r`. 

This shows that as `Freedom to make life choices` increases in a country, that country's confidence in its national government also increases. This is a positive correlation. 


### Example

Find the correlation for the newest data report (2022) from the World Happiness Report. Choose the variables of your interest.

`Enter your code below:`



## References

The material used in this document contains  excerpts and modifications from:

* Matthew J. C. Crump, Anjali Krishnan, Stephen Volz, and Alla Chavarga (2018) "Answering questions with data: Lab Manual". Last compiled on 2019-04-06. [https://www.crumplab.com/statisticsLab/](https://www.crumplab.com/statisticsLab/)

